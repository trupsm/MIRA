[
    {
        "label": "Flask",
        "importPath": "flask",
        "description": "flask",
        "isExtraImport": true,
        "detail": "flask",
        "documentation": {}
    },
    {
        "label": "request",
        "importPath": "flask",
        "description": "flask",
        "isExtraImport": true,
        "detail": "flask",
        "documentation": {}
    },
    {
        "label": "jsonify",
        "importPath": "flask",
        "description": "flask",
        "isExtraImport": true,
        "detail": "flask",
        "documentation": {}
    },
    {
        "label": "create_client",
        "importPath": "supabase",
        "description": "supabase",
        "isExtraImport": true,
        "detail": "supabase",
        "documentation": {}
    },
    {
        "label": "Client",
        "importPath": "twilio.rest",
        "description": "twilio.rest",
        "isExtraImport": true,
        "detail": "twilio.rest",
        "documentation": {}
    },
    {
        "label": "ollama",
        "kind": 6,
        "isExtraImport": true,
        "importPath": "ollama",
        "description": "ollama",
        "detail": "ollama",
        "documentation": {}
    },
    {
        "label": "openai",
        "kind": 6,
        "isExtraImport": true,
        "importPath": "openai",
        "description": "openai",
        "detail": "openai",
        "documentation": {}
    },
    {
        "label": "OpenAI",
        "importPath": "openai",
        "description": "openai",
        "isExtraImport": true,
        "detail": "openai",
        "documentation": {}
    },
    {
        "label": "os",
        "kind": 6,
        "isExtraImport": true,
        "importPath": "os",
        "description": "os",
        "detail": "os",
        "documentation": {}
    },
    {
        "label": "json",
        "kind": 6,
        "isExtraImport": true,
        "importPath": "json",
        "description": "json",
        "detail": "json",
        "documentation": {}
    },
    {
        "label": "datetime",
        "importPath": "datetime",
        "description": "datetime",
        "isExtraImport": true,
        "detail": "datetime",
        "documentation": {}
    },
    {
        "label": "timedelta",
        "importPath": "datetime",
        "description": "datetime",
        "isExtraImport": true,
        "detail": "datetime",
        "documentation": {}
    },
    {
        "label": "load_dotenv",
        "importPath": "dotenv",
        "description": "dotenv",
        "isExtraImport": true,
        "detail": "dotenv",
        "documentation": {}
    },
    {
        "label": "traceback",
        "kind": 6,
        "isExtraImport": true,
        "importPath": "traceback",
        "description": "traceback",
        "detail": "traceback",
        "documentation": {}
    },
    {
        "label": "logging",
        "kind": 6,
        "isExtraImport": true,
        "importPath": "logging",
        "description": "logging",
        "detail": "logging",
        "documentation": {}
    },
    {
        "label": "classify_severity_with_openai",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def classify_severity_with_openai(text: str):\n    \"\"\"Classify message severity via OpenAI (if available) or fallback heuristic.\"\"\"\n    t = text.lower()\n    # Quick heuristic fallback\n    def fallback():\n        if any(p in t for p in SEVERE_PHRASES):\n            return {\"label\": \"severe\", \"score\": 0.95}\n        if any(p in t for p in MODERATE_PHRASES):\n            return {\"label\": \"moderate\", \"score\": 0.6}\n        return {\"label\": \"none\", \"score\": 0.0}",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "detect_severity_tier",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def detect_severity_tier(label: str, score: float) -> str:\n    \"\"\"Convert numeric score and label into tier.\"\"\"\n    if label == \"severe\" and score >= 0.9:\n        return \"extreme\"\n    elif label == \"severe\" or score >= 0.8:\n        return \"severe\"\n    elif label == \"moderate\" or score >= 0.5:\n        return \"moderate\"\n    else:\n        return \"none\"",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "query_mira",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def query_mira(user_message: str, severity_level: str = \"none\") -> str:\n    \"\"\"Generate Mira's adaptive empathetic response via Ollama (fine-tuned) then fallback to OpenAI.\"\"\"\n    tone_map = {\n        \"none\": \"You are calm and kind, speaking like a caring friend. Be natural and supportive. Use gentle, short responses without giving advice.\",\n        \"moderate\": \"The user feels emotionally tired or hopeless. Use warmth and empathy to reassure them. Keep tone soft and human-like. Avoid giving advice or asking questions.\",\n        \"severe\": \"The user is in pain or distress. Be deeply compassionate, calm, and grounding. Avoid questions ‚Äî focus on emotional safety and presence.\",\n        \"extreme\": \"The user may be suicidal or at immediate risk. Respond with gentle urgency and safety-focused empathy. Do not ask questions or suggest actions. Just provide calm reassurance and presence.\"\n    }\n    system_prompt = (\n        \"You are Mira, a compassionate mental health companion. Respond naturally like a caring human. \"",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "get_primary_contact",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def get_primary_contact(user_id):\n    \"\"\"Fetch user's primary emergency contact from Supabase\"\"\"\n    if not supabase:\n        return None\n    try:\n        r = supabase.table(\"emergency_contacts\") \\\n            .select(\"*\") \\\n            .eq(\"user_id\", user_id) \\\n            .eq(\"is_primary\", True) \\\n            .limit(1) \\",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "send_sms",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def send_sms(phone, name, excerpt):\n    \"\"\"Send SMS via Twilio.\"\"\"\n    if not twilio:\n        raise RuntimeError(\"Twilio client not configured\")\n    body = SMS_TEMPLATES[\"urgent\"].format(contact_name=name or \"there\", excerpt=excerpt)\n    msg = twilio.messages.create(body=body, from_=TWILIO_FROM, to=phone)\n    app.logger.info(f\"üì© SMS sent to {phone}, SID: {getattr(msg, 'sid', None)}\")\n    return getattr(msg, \"sid\", None)\ndef place_call(phone):\n    \"\"\"Place call via Twilio.\"\"\"",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "place_call",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def place_call(phone):\n    \"\"\"Place call via Twilio.\"\"\"\n    if not twilio:\n        raise RuntimeError(\"Twilio client not configured\")\n    call = twilio.calls.create(to=phone, from_=TWILIO_FROM, url=\"http://demo.twilio.com/docs/voice.xml\")\n    app.logger.info(f\"üìû Call placed to {phone}, SID: {getattr(call, 'sid', None)}\")\n    return getattr(call, \"sid\", None)\ndef safe_insert(table: str, data: dict, dedupe_window_seconds: int = 2):\n    \"\"\"\n    Insert to Supabase but avoid near-duplicate inserts.",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "safe_insert",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def safe_insert(table: str, data: dict, dedupe_window_seconds: int = 2):\n    \"\"\"\n    Insert to Supabase but avoid near-duplicate inserts.\n    Logic: fetch most recent row for (user_id, sender) and if message matches within dedupe_window_seconds, skip.\n    This prevents duplicate chat_history rows when routes get retried or double-called.\n    \"\"\"\n    if not supabase:\n        app.logger.debug(\"Supabase not configured; skipping insert to %s\", table)\n        return None\n    try:",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "health",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def health():\n    return jsonify({\"status\": \"ok\", \"service\": \"mira_agent\"})\n@app.route('/api/mira_chat', methods=['POST'])\ndef mira_chat():\n    data = request.json or {}\n    user_id = data.get(\"user_id\")\n    message = (data.get(\"message\") or \"\").strip()\n    if not user_id or not message:\n        return jsonify({\"error\": \"user_id and message required\"}), 400\n    # Log user message (dedupe-safe)",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "mira_chat",
        "kind": 2,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "def mira_chat():\n    data = request.json or {}\n    user_id = data.get(\"user_id\")\n    message = (data.get(\"message\") or \"\").strip()\n    if not user_id or not message:\n        return jsonify({\"error\": \"user_id and message required\"}), 400\n    # Log user message (dedupe-safe)\n    safe_insert(\"chat_history\", {\n        \"user_id\": user_id,\n        \"sender\": \"user\",",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "os.environ[\"OLLAMA_HOST\"]",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "os.environ[\"OLLAMA_HOST\"] = os.getenv(\"OLLAMA_HOST\", \"http://127.0.0.1:11434\")\napp = Flask(__name__)\nlogging.basicConfig(level=logging.INFO)\n# Supabase setup\nSUPABASE_URL = os.getenv(\"SUPABASE_URL\")\nSUPABASE_KEY = os.getenv(\"SUPABASE_SERVICE_ROLE_KEY\")\nsupabase = None\nif SUPABASE_URL and SUPABASE_KEY:\n    try:\n        supabase = create_client(SUPABASE_URL, SUPABASE_KEY)",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "app",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "app = Flask(__name__)\nlogging.basicConfig(level=logging.INFO)\n# Supabase setup\nSUPABASE_URL = os.getenv(\"SUPABASE_URL\")\nSUPABASE_KEY = os.getenv(\"SUPABASE_SERVICE_ROLE_KEY\")\nsupabase = None\nif SUPABASE_URL and SUPABASE_KEY:\n    try:\n        supabase = create_client(SUPABASE_URL, SUPABASE_KEY)\n        app.logger.info(\"‚úÖ Supabase initialized\")",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "SUPABASE_URL",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "SUPABASE_URL = os.getenv(\"SUPABASE_URL\")\nSUPABASE_KEY = os.getenv(\"SUPABASE_SERVICE_ROLE_KEY\")\nsupabase = None\nif SUPABASE_URL and SUPABASE_KEY:\n    try:\n        supabase = create_client(SUPABASE_URL, SUPABASE_KEY)\n        app.logger.info(\"‚úÖ Supabase initialized\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå Supabase init error: {e}\")\nelse:",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "SUPABASE_KEY",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "SUPABASE_KEY = os.getenv(\"SUPABASE_SERVICE_ROLE_KEY\")\nsupabase = None\nif SUPABASE_URL and SUPABASE_KEY:\n    try:\n        supabase = create_client(SUPABASE_URL, SUPABASE_KEY)\n        app.logger.info(\"‚úÖ Supabase initialized\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå Supabase init error: {e}\")\nelse:\n    app.logger.warning(\"‚ö†Ô∏è Supabase not configured\")",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "supabase",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "supabase = None\nif SUPABASE_URL and SUPABASE_KEY:\n    try:\n        supabase = create_client(SUPABASE_URL, SUPABASE_KEY)\n        app.logger.info(\"‚úÖ Supabase initialized\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå Supabase init error: {e}\")\nelse:\n    app.logger.warning(\"‚ö†Ô∏è Supabase not configured\")\n# Twilio setup",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "TWILIO_SID",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "TWILIO_SID = os.getenv(\"TWILIO_ACCOUNT_SID\")\nTWILIO_TOKEN = os.getenv(\"TWILIO_AUTH_TOKEN\")\nTWILIO_FROM = os.getenv(\"TWILIO_FROM_NUMBER\")\ntwilio = None\nif TWILIO_SID and TWILIO_TOKEN:\n    try:\n        twilio = TwilioClient(TWILIO_SID, TWILIO_TOKEN)\n        app.logger.info(\"‚úÖ Twilio initialized\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå Twilio init error: {e}\")",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "TWILIO_TOKEN",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "TWILIO_TOKEN = os.getenv(\"TWILIO_AUTH_TOKEN\")\nTWILIO_FROM = os.getenv(\"TWILIO_FROM_NUMBER\")\ntwilio = None\nif TWILIO_SID and TWILIO_TOKEN:\n    try:\n        twilio = TwilioClient(TWILIO_SID, TWILIO_TOKEN)\n        app.logger.info(\"‚úÖ Twilio initialized\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå Twilio init error: {e}\")\nelse:",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "TWILIO_FROM",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "TWILIO_FROM = os.getenv(\"TWILIO_FROM_NUMBER\")\ntwilio = None\nif TWILIO_SID and TWILIO_TOKEN:\n    try:\n        twilio = TwilioClient(TWILIO_SID, TWILIO_TOKEN)\n        app.logger.info(\"‚úÖ Twilio initialized\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå Twilio init error: {e}\")\nelse:\n    app.logger.warning(\"‚ö†Ô∏è Twilio not configured\")",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "twilio",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "twilio = None\nif TWILIO_SID and TWILIO_TOKEN:\n    try:\n        twilio = TwilioClient(TWILIO_SID, TWILIO_TOKEN)\n        app.logger.info(\"‚úÖ Twilio initialized\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå Twilio init error: {e}\")\nelse:\n    app.logger.warning(\"‚ö†Ô∏è Twilio not configured\")\n# OpenAI fallback (use new OpenAI client when available)",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "OPENAI_API_KEY",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "OPENAI_API_KEY = os.getenv(\"OPENAI_API_KEY\")\nopenai_client = None\nif OPENAI_API_KEY:\n    try:\n        openai_client = OpenAI(api_key=OPENAI_API_KEY)\n        app.logger.info(\"‚úÖ OpenAI client configured\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå OpenAI init error: {e}\")\n# Default Ollama model (trim whitespace)\nOLLAMA_MODEL = os.getenv(\"OLLAMA_MODEL\", \"tinyllama:1.1b\").strip()",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "openai_client",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "openai_client = None\nif OPENAI_API_KEY:\n    try:\n        openai_client = OpenAI(api_key=OPENAI_API_KEY)\n        app.logger.info(\"‚úÖ OpenAI client configured\")\n    except Exception as e:\n        app.logger.error(f\"‚ùå OpenAI init error: {e}\")\n# Default Ollama model (trim whitespace)\nOLLAMA_MODEL = os.getenv(\"OLLAMA_MODEL\", \"tinyllama:1.1b\").strip()\n# ------------------ CONSTANTS ------------------",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "OLLAMA_MODEL",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "OLLAMA_MODEL = os.getenv(\"OLLAMA_MODEL\", \"tinyllama:1.1b\").strip()\n# ------------------ CONSTANTS ------------------\nSMS_TEMPLATES = {\n    \"urgent\": \"URGENT (confidential): {contact_name}, your contact may be at immediate risk. Excerpt: \\\"{excerpt}\\\". Please reach out or ensure their safety now.\"\n}\nSEVERE_PHRASES = [\n    \"i want to die\", \"kill myself\", \"end my life\", \"i have a plan\",\n    \"going to do it\", \"suicide\", \"no reason to live\", \"goodbye forever\"\n]\nMODERATE_PHRASES = [",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "SMS_TEMPLATES",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "SMS_TEMPLATES = {\n    \"urgent\": \"URGENT (confidential): {contact_name}, your contact may be at immediate risk. Excerpt: \\\"{excerpt}\\\". Please reach out or ensure their safety now.\"\n}\nSEVERE_PHRASES = [\n    \"i want to die\", \"kill myself\", \"end my life\", \"i have a plan\",\n    \"going to do it\", \"suicide\", \"no reason to live\", \"goodbye forever\"\n]\nMODERATE_PHRASES = [\n    \"can't go on\", \"tired of living\", \"hopeless\", \"nothing matters\",\n    \"want to disappear\", \"give up\", \"done with life\"",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "SEVERE_PHRASES",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "SEVERE_PHRASES = [\n    \"i want to die\", \"kill myself\", \"end my life\", \"i have a plan\",\n    \"going to do it\", \"suicide\", \"no reason to live\", \"goodbye forever\"\n]\nMODERATE_PHRASES = [\n    \"can't go on\", \"tired of living\", \"hopeless\", \"nothing matters\",\n    \"want to disappear\", \"give up\", \"done with life\"\n]\n# ------------------ HELPERS ------------------\ndef classify_severity_with_openai(text: str):",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    },
    {
        "label": "MODERATE_PHRASES",
        "kind": 5,
        "importPath": "backend.services.mira_agent",
        "description": "backend.services.mira_agent",
        "peekOfCode": "MODERATE_PHRASES = [\n    \"can't go on\", \"tired of living\", \"hopeless\", \"nothing matters\",\n    \"want to disappear\", \"give up\", \"done with life\"\n]\n# ------------------ HELPERS ------------------\ndef classify_severity_with_openai(text: str):\n    \"\"\"Classify message severity via OpenAI (if available) or fallback heuristic.\"\"\"\n    t = text.lower()\n    # Quick heuristic fallback\n    def fallback():",
        "detail": "backend.services.mira_agent",
        "documentation": {}
    }
]